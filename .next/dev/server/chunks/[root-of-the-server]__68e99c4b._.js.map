{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/stanislavozarchuk/Projects/matrix-ton/frontend/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,4MAAY,EAAC,aAAa"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/stanislavozarchuk/Projects/matrix-ton/frontend/app/api/user/register/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { supabase } from '@/lib/supabase';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { \n      telegramId, \n      username, \n      nickname, \n      referralCode, \n      country,\n      // New fields\n      firstName,\n      lastName,\n      languageCode,\n      phoneNumber,\n      isPremium\n    } = body;\n\n    // Find referrer\n    let referrerId = 1; // Default to MASTER\n    if (referralCode && referralCode !== 'MASTER') {\n      const { data: referrer } = await supabase\n        .from('User')\n        .select('id')\n        .eq('referralCode', referralCode)\n        .single();\n      \n      if (referrer) {\n        referrerId = referrer.id;\n      }\n    }\n\n    // Generate referral code (max 10 chars)\n    const referralCodeValue = nickname.toUpperCase().slice(0, 10);\n\n    // Create user with extended data\n    // Note: tonWallet is unique, so we use a placeholder that will be updated later\n    const tonWalletPlaceholder = `pending_${telegramId}_${Date.now()}`;\n\n    const { data: user, error } = await supabase\n      .from('User')\n      .insert({\n        telegramId: telegramId.toString(),\n        telegramUsername: username,\n        nickname,\n        referrerId,\n        referralCode: referralCodeValue,\n        isPremium: isPremium || true,\n        accountCreatedDate: new Date().toISOString(),\n        tonWallet: tonWalletPlaceholder,\n        role: 'USER',\n        isVerified: true,\n        // New fields - store as JSON in a metadata column if schema allows\n        // Or add these fields to User table schema\n        metadata: {\n          firstName,\n          lastName,\n          languageCode,\n          phoneNumber: phoneNumber || null,\n          country: country || 'Unknown',\n          registeredAt: new Date().toISOString(),\n          registeredFrom: 'web_app'\n        }\n      })\n      .select()\n      .single();\n\n    if (error) {\n      console.error('Registration error:', error);\n      return NextResponse.json({ error: error.message }, { status: 400 });\n    }\n\n    return NextResponse.json({ success: true, user });\n  } catch (error) {\n    console.error('Registration error:', error);\n    return NextResponse.json({ error: 'Registration failed' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,UAAU,EACV,QAAQ,EACR,QAAQ,EACR,YAAY,EACZ,OAAO,EACP,aAAa;QACb,SAAS,EACT,QAAQ,EACR,YAAY,EACZ,WAAW,EACX,SAAS,EACV,GAAG;QAEJ,gBAAgB;QAChB,IAAI,aAAa,GAAG,oBAAoB;QACxC,IAAI,gBAAgB,iBAAiB,UAAU;YAC7C,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,yIAAQ,CACtC,IAAI,CAAC,QACL,MAAM,CAAC,MACP,EAAE,CAAC,gBAAgB,cACnB,MAAM;YAET,IAAI,UAAU;gBACZ,aAAa,SAAS,EAAE;YAC1B;QACF;QAEA,wCAAwC;QACxC,MAAM,oBAAoB,SAAS,WAAW,GAAG,KAAK,CAAC,GAAG;QAE1D,iCAAiC;QACjC,gFAAgF;QAChF,MAAM,uBAAuB,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE,KAAK,GAAG,IAAI;QAElE,MAAM,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yIAAQ,CACzC,IAAI,CAAC,QACL,MAAM,CAAC;YACN,YAAY,WAAW,QAAQ;YAC/B,kBAAkB;YAClB;YACA;YACA,cAAc;YACd,WAAW,aAAa;YACxB,oBAAoB,IAAI,OAAO,WAAW;YAC1C,WAAW;YACX,MAAM;YACN,YAAY;YACZ,mEAAmE;YACnE,2CAA2C;YAC3C,UAAU;gBACR;gBACA;gBACA;gBACA,aAAa,eAAe;gBAC5B,SAAS,WAAW;gBACpB,cAAc,IAAI,OAAO,WAAW;gBACpC,gBAAgB;YAClB;QACF,GACC,MAAM,GACN,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;AACF"}}]
}